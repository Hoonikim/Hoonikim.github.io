---
 layout: single
title: "[CI/CD] ê¸°ë³¸ê°œë… ë° ì‹¤ìŠµ"
categories: CI/CD
tags: [ë°°í¬, AWS, CI/CD]
toc: true



---

###  2023.02.03(ê¸ˆ)

### Chapter1. ë°°í¬ ìë™í™”     

ë°°í¬ ìë™í™”ë€ í•œë²ˆì˜ í´ë¦­ í˜¹ì€ ëª…ë ¹ì–´ ì…ë ¥ì„ í†µí•´ ì „ì²´ ë°°í¬ ê³¼ì •ì„ ìë™ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì„ ëœ»í•œë‹¤. ë°°í¬ ìë™í™”ê°€ ì™œ í•„ìš”í• ê¹Œ?

- ìˆ˜ë™ì ì´ê³  ë°˜ë³µì ì¸ ë°°í¬ ê³¼ì •ì„ ìë™í™”í•¨ìœ¼ë¡œì¨ ì‹œê°„ì´ ì ˆì•½ëœë‹¤.
- íœ´ë¨¼ ì—ëŸ¬(Human Error)ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
  - ì—¬ê¸°ì„œ íœ´ë¨¼ ì—ëŸ¬ë€ ì‚¬ëŒì´ ìˆ˜ë™ì ìœ¼ë¡œ ë°°í¬ ê³¼ì •ì„ ì§„í–‰í•˜ëŠ” ì¤‘ì— ìƒê¸°ëŠ” ì‹¤ìˆ˜ë“¤ì„ ëœ»í•œë‹¤. ê·¸ ì „ì— í–ˆë˜ ë°°í¬ ê³¼ì •ê³¼ ë¹„êµí•˜ì—¬ íŠ¹ì • ê³¼ì •ì„ ìƒëµí•˜ê±°ë‚˜ ë‹¤ë¥´ê²Œ ì§„í–‰í•˜ì—¬ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ íœ´ë¨¼ ì—ëŸ¬ì˜ ì˜ˆë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

ë°°í¬ ìë™í™”ë¥¼ í†µí•´ ì „ì²´ ë°°í¬ ê³¼ì •ì„ ë§¤ë²ˆ ì¼ê´€ë˜ê²Œ ì§„í–‰í•˜ëŠ” êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì—¬ íœ´ë¨¼ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„±ì„ ë‚®ì¶œ ìˆ˜ ìˆë‹¤.

#### ë°°í¬ ìë™í™” íŒŒì´í”„ë¼ì¸ 

![img](https://velog.velcdn.com/images/mmmdo21/post/f83d43d5-148a-4e0a-b5fb-975106960813/image.png)

ë°°í¬ì—ì„œ íŒŒì´í”„ë¼ì¸(Pipeline)ì´ë€ ìš©ì–´ëŠ” ì†ŒìŠ¤ ì½”ë“œì˜ ê´€ë¦¬ë¶€í„° ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œì˜ ë°°í¬ ê³¼ì •ì„ ì—°ê²°í•˜ëŠ” êµ¬ì¡°ë¥¼ ëœ»í•œë‹¤.

íŒŒì´í”„ë¼ì¸ì€ ì „ì²´ ë°°í¬ ê³¼ì •ì„ ì—¬ëŸ¬ ë‹¨ê³„(Stages)ë¡œ ë¶„ë¦¬í•œë‹¤. ê° ë‹¨ê³„ëŠ” íŒŒì´í”„ë¼ì¸ ì•ˆì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ê° ë‹¨ê³„ë§ˆë‹¤ ì£¼ì–´ì§„ ì‘ì—…(Actions)ë“¤ì„ ìˆ˜í–‰í•œë‹¤.

íŒŒì´í”„ë¼ì¸ì„ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ë¶„ë¦¬í•  ë•Œ, ëŒ€í‘œì ìœ¼ë¡œ ì“°ì´ëŠ” ì„¸ ê°€ì§€ ë‹¨ê³„ê°€ ì¡´ì¬í•œë‹¤.

- **Source ë‹¨ê³„**: Source ë‹¨ê³„ì—ì„œëŠ” ì›ê²© ì €ì¥ì†Œì— ê´€ë¦¬ë˜ê³  ìˆëŠ” ì†ŒìŠ¤ ì½”ë“œì— ë³€ê²½ ì‚¬í•­ì´ ì¼ì–´ë‚  ê²½ìš°, ì´ë¥¼ ê°ì§€í•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ ì „ë‹¬í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
- **Build ë‹¨ê³„**: Build ë‹¨ê³„ì—ì„œëŠ” Source ë‹¨ê³„ì—ì„œ ì „ë‹¬ë°›ì€ ì½”ë“œë¥¼ ì»´íŒŒì¼, ë¹Œë“œ, í…ŒìŠ¤íŠ¸í•˜ì—¬ ê°€ê³µí•œë‹¤. ë˜í•œ Build ë‹¨ê³„ë¥¼ ê±°ì³ ìƒì„±ëœ ê²°ê³¼ë¬¼ì„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì „ë‹¬í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
- **Deploy ë‹¨ê³„**: Deploy ë‹¨ê³„ì—ì„œëŠ” Build ë‹¨ê³„ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ê²°ê³¼ë¬¼ì„ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

íŒŒì´í”„ë¼ì¸ì˜ ë‹¨ê³„ëŠ” í•„ìš”ì— ë”°ë¼ ë” ì„¸ë¶„í™”ë˜ê±°ë‚˜ ê°„ì†Œí™”ë  ìˆ˜ ìˆë‹¤. DevOpsë¥¼ ì „ë¬¸ìœ¼ë¡œ í•™ìŠµí•˜ëŠ” ê²½ìš° ì•„ë˜ì™€ ê°™ì´ íŒŒì´í”„ë¼ì¸ì˜ ë‹¨ê³„ë¥¼ ì„¸ë¶„í™”í•´ì„œ ë‚˜ëˆ„ê¸°ë„ í•œë‹¤. ë˜í•œ, í•´ë‹¹ íˆ´ì„ ì†Œê°œí•˜ëŠ” ì—…ì²´ì— ë”°ë¼ ìš©ì–´ë¥¼ ë¯¸ë¬˜í•˜ê²Œ ë‹¤ë¥´ê²Œ ì‚¬ìš©í•˜ê¸°ë„ í•œë‹¤.

#### CI/CD íŒŒì´í”„ë¼ì¸

![img](https://velog.velcdn.com/images/mmmdo21/post/49e0be50-a023-4c72-b84c-487a961b65b4/image.png)

# Chapter1-1. ì§€ì†ì  í†µí•©

## ì§€ì†ì  í†µí•© (CI; continuous integration)

íŒ€ êµ¬ì„±ì›ì´ ê°ìì˜ ì‘ì—…ì„ ìì£¼ í†µí•©í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë°©ì‹. CIëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ë‹¨ê³„ë¡œ ë‚˜ë‰œë‹¤.![img](https://velog.velcdn.com/images/mmmdo21/post/1514a6f1-34f6-4335-9c5b-b29b9528c9b4/image.png)

- **Code**: ê°œë°œìê°€ ì½”ë“œë¥¼ ì½”ë“œ ì €ì¥ì†Œì— Pushí•œë‹¤.
- **Build**: ì½”ë“œ ì €ì¥ì†Œë¡œë¶€í„° ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ (ìœ ë‹› í…ŒìŠ¤íŠ¸ í›„) ë¹Œë“œí•œë‹¤.
- **(Test)**: ì½”ë“œ ë¹Œë“œì˜ ê²°ê³¼ë¬¼ì´ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì™€ ì˜ í†µí•©ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

> **ë¹Œë“œ**ëŠ” ê°œë°œìë§Œ ì½ì„ìˆ˜ ìˆëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œ ë° í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ë‹¤. ë²ˆë“¤ë§ë„ ë¸Œë¼ìš°ì €ê°€ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë” ì˜ ì½ì„ ìˆ˜ ìˆê²Œ ë„ì™€ì¤Œìœ¼ë¡œ, ë¹Œë“œì˜ ê³¼ì • ì¤‘ í•˜ë‚˜ë¡œ ë³¼ ìˆ˜ ìˆë‹¤. ì¢…ì¢… ë‘ ìš©ì–´ ëª¨ë‘ "ë¹Œë“œ"ë¡œ í†µìš©ë˜ê¸°ë„ í•œë‹¤.

ì§€ì†ì  í†µí•©ì€ ëª¨ë“  ì½”ë“œ ë³€í™”ë¥¼ í•˜ë‚˜ì˜ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒ ë¶€í„° ì‹œì‘í•œë‹¤. ëª¨ë“  ê°œë°œíŒ€ì´ ì½”ë“œì˜ ë³€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, íˆ¬ëª…í•˜ê²Œ ë¬¸ì œì ì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  ì¦ì€ í’€ ë¦¬í€˜ìŠ¤íŠ¸(pull request)ì™€ ë¨¸ì§€(merge)ë¡œ ì½”ë“œë¥¼ ìì£¼ í†µí•©í•œë‹¤. ì´ ë•Œ, ê¸°ë³¸ì ì¸ í…ŒìŠ¤íŠ¸ë„ ì‘ë™ì‹œí‚¬ ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ì§€ì†ì  í†µí•©ì„ í†µí•´ ê°œë°œíŒ€ì€ ê°ì ê°œë°œí•œ ì½”ë“œë¥¼ ì´ë¥¸ ì‹œì ì—, ìì£¼ í•©ì¹˜ê³ , ìì£¼ í…ŒìŠ¤íŠ¸ í•´ë³¼ ìˆ˜ ìˆë‹¤.

ì§€ì†ì  í†µí•©ìœ¼ë¡œ ë³´ì•ˆ ì´ìŠˆ, ì—ëŸ¬ ë“±ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆì–´ í•´ë‹¹ ì´ìŠˆë¥¼ ë¹ ë¥´ê²Œ ê°œì„ í•  ìˆ˜ ìˆë‹¤. ì´ì „ì—ëŠ” ê°ì ê°œë°œìê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ í•©ì¹˜ê³  ë‚œ í›„, ëª¨ë‘ ëª¨ì—¬ì„œ ë¹Œë“œë¥¼ ì‹œì‘í•˜ê³  ë‚˜ì„œì•¼ ë¬¸ì œì ì„ íŒŒì•…í•  ìˆ˜ ìˆì—ˆë‹¤. ì§€ì†ì  í†µí•©ì´ ì ìš©ëœ ê°œë°œíŒ€ì€ ì½”ë“œë¥¼ ë¨¸ì§€í•˜ê¸° ì „, ì´ë¯¸ ë¹Œë“œ ì˜¤ë¥˜ë‚˜ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì—¬ í›¨ì”¬ ë” íš¨ìœ¨ì ì¸ ê°œë°œì„ í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## [ì‹¤ìŠµ] ì§€ì†ì  í†µí•©

ì´ë²ˆ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤ì™€ Github Actionì„ ì´ìš©í•˜ì—¬ ì§„í–‰í•œë‹¤.
[ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤](https://urclass.codestates.com/content/a1755af6-d0dd-4156-bbed-2d7382092018?playlist=1612)

1. ë¨¼ì €, ìì‹ ì˜ ê¹ƒí—ˆë¸Œ ê³„ì •ì— ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë§Œë“ ë‹¤.
2. ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ì— ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤ ì½”ë“œë¥¼ pushí•œë‹¤. drag & dropì„ í•  ìˆ˜ë„ ìˆê² ì§€ë§Œ, ê°€ëŠ¥í•˜ë©´ ê¸°ì¡´ ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤ë¥¼ í´ë¡ ë°›ì•„ì„œ, ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì›ê²© ë¦¬í¬ì§€í† ë¦¬ë¡œ ë“±ë¡í•˜ê³ , ì½”ë“œë¥¼ push í•´ë³´ì.

```sh
# ê¸°ì¡´ ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤ í´ë¡ 
git clone git@github.com:codestates-seb/fe-sprint-my-agora-states-server-reference.git
# ë””ë ‰í„°ë¦¬ ì´ë™
cd fe-sprint-my-agora-states-server-reference
# ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì›ê²© ë¦¬í¬ì§€í† ë¦¬ë¡œ ë“±ë¡
git remote add myRepo git@github.com:{ì—¬ëŸ¬ë¶„ì˜ ì•„ì´ë””}/{ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„}.git
# ê¸°ì¡´ ë ˆí¼ëŸ°ìŠ¤ ì½”ë“œë¥¼ ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¡œ push
git push myRepo reference
```

1. ì½”ë“œê°€ ëª¨ë‘ pushê°€ ë˜ë©´, ì»¤ë°‹ ê¸°ë¡ì„ ë³´ì‹œë©´, **ì£¼í™©ìƒ‰ ì›**ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
   ![img](https://velog.velcdn.com/images/mmmdo21/post/42ee0c36-a5d9-457a-b36a-c2ce76f4ed82/image.png)
2. ì£¼í™©ìƒ‰ ì›ì´ ë¬´ì—‡ì¸ì§€ ì¢€ ë” ìì„¸íˆ íŒŒì•…í•˜ê¸° ìœ„í•´ Actions íƒ­ìœ¼ë¡œ ì´ë™í•œë‹¤. Github Actionì„ ì½”ë“œë¥¼ ì„¤ì •í•´ë‘ë©´ ì´ë ‡ê²Œ ì„œë²„ í…ŒìŠ¤íŠ¸ê°€ ìë™ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
   ![img](https://velog.velcdn.com/images/mmmdo21/post/e94544bd-a59d-4383-a1eb-0eeca25d8c1e/image.png)

Github Actionì€ Githubì˜ íŠ¹ì • ì´ë²¤íŠ¸ì— ë§ê²Œ ë‹¤ì–‘í•œ ì‘ì—…ì„ ì‹œí‚¬ ìˆ˜ ìˆëŠ” CI/CD í”Œë ›í¼ì´ë‹¤. EC2ì™€ ê°™ì€ í•˜ë‚˜ì˜ ê°€ìƒ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰ì‹œì¼œì„œ ì›í•˜ëŠ” ì‘ì—…ì„ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

ê·¸ëŸ°ë°, ë¦¬í¬ì§€í† ë¦¬ë¥¼ pushí•˜ê¸°ë§Œ í–ˆëŠ”ë°, ì™œ ì‘ë™í–ˆì„ê¹Œ? `./.github/workflows/pullRequest.yml` íŒŒì¼ì„ ì½ì–´ë³´ë©´, ì–¸ì œ ì–´ë–¤ **job**ì„ í• ì§€ ëª…ì‹œë˜ì–´ ìˆë‹¤.

```yaml
name: Bare Minimum Requirements

# ì–¸ì œ jobì„ ì‘ë™ì‹œí‚¬ì§€
on: [push, pull_request]

# ì–´ë–¤ jobì„ í• ì§€
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Bare Minimum Requirements
        uses: actions/setup-node@v1
        with:
          node-version: '16'
      - run: npm install
      - run: npm test
```

`npm install`ì€ ë¹Œë“œë¥¼ ìœ„í•œ ì¤€ë¹„ê³¼ì •ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤. Node.jsë¡œ ë§Œë“  ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ npmìœ¼ë¡œ ê´€ë ¨ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ëª¨ë‘ ê¹”ë”í•˜ê²Œ ì„¤ì¹˜í•´ì•¼ ì‘ë™í•˜ê¸° ë•Œë¬¸.
`npm test`ëŠ” ìœ ë‹› í…ŒìŠ¤íŠ¸ ê³¼ì •ì´ë‹¤. ì‘ì„±í•œ ì½”ë“œê°€ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±ì„ ìœ„í•œ ìµœì†Œí•œì˜ ì¡°ê±´ì„ ë§Œì¡±í–ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

[github actions ê³µì‹ë¬¸ì„œ](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions)

# Chapter1-2. ì§€ì†ì  ë°°í¬

## ì§€ì†ì  ë°°í¬ (CD; continuous delivery, continuous deployment)

ì§€ì†ì  ë°°í¬ëŠ” ì§€ì†ì  í†µí•© ê³¼ì •ì´ ì›í™œí•˜ê²Œ ëë‚˜ë©´ ë°”ë¡œ ê³ ê°ì—ê²Œ ë°°í¬í•˜ëŠ” ê²ƒì´ë‹¤.![img](https://velog.velcdn.com/images/mmmdo21/post/679d386f-8675-40ca-b38d-ce1093b0a5d0/image.png)

ì§€ì†ì  ë°°í¬ëŠ” í¬ê²Œ 3ê°€ì§€ ê³¼ì •ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.

- **Release**: ë¦´ë¦¬ì¦ˆ ë‹¨ê³„ì—ì„œëŠ” ë¹Œë“œê¹Œì§€ ëª¨ë‘ ì¤€ë¹„ê°€ ë˜ì—ˆê³ , ì–´ë–¤ ê¸°ëŠ¥ì´ ê°œë°œë˜ì—ˆëŠ”ì§€ ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ê³„ìë“¤ê³¼ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ëŠ” ë‹¨ê³„ì´ë‹¤. ì–´ë–¤ ê¸°ëŠ¥ì„ ë„£ì„ì§€, í•´ë‹¹ ë¦´ë¦¬ì¦ˆëŠ” ë°°í¬ë¥¼ í• ì§€ ë§ì§€ ê²°ì •í•˜ëŠ” ë‹¨ê³„ë¡œ ì—¬ëŸ¬ ì˜ì‚¬ê²°ì •ì´ ì´ë£¨ì–´ì§„ë‹¤.
- **Deploy**: ì‹¤ì œ ë°°í¬í•œë‹¤.      
- **Operation**: ë°°í¬ëœ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹¤ì œ ìš´ìš©í•˜ëŠ” ê³¼ì •ì´ë‹¤. í•´ë‹¹ ê³¼ì •ì—ì„œ ê³ ê°ì˜ í”¼ë“œë°±ì„ ì¶©ë¶„íˆ ë°›ì•„ ê¸°íšì— ë°˜ì˜í•œë‹¤.

ìµœê·¼ì—ëŠ” í´ë¼ìš°ë“œ ê¸°ìˆ  ë°œì „ê³¼ ë§ë¬¼ë ¤ ì§€ì†ì  í†µí•©ê³¼ ì§€ì†ì  ë°°í¬ê°€ ë¹ ë¥¸ ì†ë„ë¡œ ì§„í–‰ë˜ë©´ì„œ CI/CDë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ ë‹¤ë£¨ëŠ” ê²½ìš°ê°€ ì ì°¨ ì¦ê°€í•˜ê³  ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ì „ì—ëŠ” ë°°í¬ ìì²´ê°€ ìƒë‹¹íˆ ì˜¤ë˜ ê±¸ë¦¬ê³  í˜ë“  ì¼ì´ì–´ì„œ ë¦´ë¦¬ì¦ˆ ë‹¨ê³„ì—ì„œ ë§ì€ ê³ ë¯¼ì„ í•˜ê³¤ í–ˆë‹¤. ì„œë²„ë¥¼ ì „ë¶€ ì¬ì‹œì‘í•´ì•¼ í•œë‹¤ê±°ë‚˜, ì¼ë¶€ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ë„ ë§ì•˜ê¸° ë•Œë¬¸. ìš”ì¦˜ì€ ê³ ê°ì˜ í”¼ë“œë°±ì„ ë¹¨ë¦¬ ë°›ê¸° ìœ„í•´ì„œë¼ë„, ì„œë¹„ìŠ¤ë¥¼ ì¤‘ë‹¨í•˜ì§€ ì•Šê¸° ìœ„í•´ì„œë¼ë„ ë²„ì „ ë¦´ë¦¬ì¦ˆë§Œ ì˜ ê¸°ë¡í•´ë‘ê³  ë°”ë¡œë°”ë¡œ ë°°í¬í•˜ëŠ” ì‚¬ë¡€ê°€ ì¦ê°€í•˜ê³  ìˆë‹¤.

> ì‹¤ë¦¬ì½˜ë°¸ë¦¬ í…Œí¬ ê¸°ì—…ë“¤ì€ ë‹¤ì–‘í•œ ëª¨ë‹ˆí„°ë§ íˆ´ê³¼ ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤ë¥¼ ë§ˆë ¨í•´ ë°°í¬ì— ëŒ€í•œ ìì‹ ê°ì„ ë†’ì—¬ ì¡°ì§ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ì—­ëŸ‰ì„ í‚¤ìš°ê³  ìˆë‹¤. â€œí•˜ë£¨ì— 1,000ë²ˆì˜ ë°°í¬ë¥¼ í•  ìˆ˜ ìˆëŠ”ê°€?â€ ëŠ” ì¡°ì§ì˜ ê¸°ìˆ ì  í™•ì¥ ì—­ëŸ‰ì„ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤.
> [í•˜ë£¨ì— 1000ë²ˆ ë°°í¬í•˜ëŠ” ì¡°ì§ë˜ê¸°-ë±…í¬ìƒëŸ¬ë“œ](https://blog.banksalad.com/tech/become-an-organization-that-deploys-1000-times-a-day/)

## ì§€ì†ì  ë°°í¬ ì‚¬ë¡€

ì§€ì†ì  ë°°í¬ì˜ ê°€ì¥ í”í•œ ì‚¬ë¡€ê°€ Github Page.

ì§€ì •í•´ë‘” ë””ë ‰í„°ë¦¬ì— ì •í•´ì§„ ë°©ì‹ì— ë”°ë¼ ì˜ ì»¤ë°‹í•˜ê¸°ë§Œ í•˜ë©´, Github Pageê°€ ì•Œì•„ì„œ í•´ë‹¹ index.html íŒŒì¼ê³¼ í•´ë‹¹ ë””ë ‰í„°ë¦¬ì— ìˆëŠ” íŒŒì¼ì„ ì˜ ë²ˆë“¤ë§í•´ì„œ Github Page ì„œë²„ì— ì—…ë¡œë“œí•œë‹¤.

ì´ë ‡ê²Œ ìë™ìœ¼ë¡œ ì¸í„°ë„·ì— ë°°í¬ê°€ ë˜ì—ˆê³ , ì£¼ë³€ ê°€ì¡±ì´ë‚˜ ì¹œêµ¬ë“¤ì—ê²Œ ì‰½ê²Œ ë§Œë“  ê²°ê³¼ë¬¼ì„ ê³µìœ í•  ìˆ˜ ìˆë‹¤. (í‹€ë¦° ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë¹ ë¥´ê²Œ í”¼ë“œë°±ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.)

------

# Chapter2. Vercel - í´ë¼ì´ì–¸íŠ¸ ë°°í¬

Vercelì€ Netlifyì™€ í•¨ê»˜ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ë¥¼ ìë™í™”í™”ê³ , ê·¸ ì™¸ ì—¬ëŸ¬ ì¶”ê°€ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë°°í¬ í”„ë ˆì„ì›Œí¬ì´ë‹¤. ê¹ƒí—ˆë¸Œ ì•„ì´ë””ë¥¼ í†µí•´ ì‰½ê²Œ ê°€ì…í•  ìˆ˜ ìˆë‹¤.

1.new project í´ë¦­
2.ê²€ìƒ‰ì–´ ì¹˜ë ¤ê³  ë³´ë©´ configure Github appì´ ëœ¸ -> ì¸ì¦ -> select ë¦¬í¬ì§€í† ë¦¬
![img](https://velog.velcdn.com/images/mmmdo21/post/91453033-0171-4756-b192-5adbb6daac9f/image.png)![img](https://velog.velcdn.com/images/mmmdo21/post/5e34ef55-95fc-4099-a8ab-d1636c701107/image.png)![img](https://velog.velcdn.com/images/mmmdo21/post/102c2e74-bd82-41c2-bf8b-29376a574fac/image.png)

ì´í›„, í”„ë¡œì íŠ¸ ì„¤ì • í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.

- Project name: í”„ë¡œì íŠ¸ì˜ ì´ë¦„
- Framework preset: ì‚¬ìš©ì„ ì›í•˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œ í”„ë ˆì„ì›Œí¬
  `Create React App`
- Root directory: ë£¨íŠ¸ ë””ë ‰í„°ë¦¬ ìœ„ì¹˜
  `my-agora-states-client` -- ë°°í¬ëŠ” í´ë¼ì´ì–¸íŠ¸ ë””ë ‰í† ë¦¬,,
- Build command: ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
- Output directory: ë¹Œë“œ ê²°ê³¼ ë””ë ‰í„°ë¦¬ ìœ„ì¹˜
- Install command: ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
  ìì‹ ì˜ í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ì–´ë””ì¸ì§€ íŒŒì•…í•˜ê³ , Deployë¥¼ ëˆ„ë¥¸ë‹¤.

ì´í›„ì—ëŠ” Deployê°€ ì‹œì‘ëœë‹¤. Vercelì´ EC2ì™€ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë”°ë¡œ ì‹¤í–‰ì‹œì¼œ, ë¹Œë“œ ë° ë°°í¬ë¥¼ ìë™ìœ¼ë¡œ ì§„í–‰í•œë‹¤.

ëŒ€ì‹œë³´ë“œë¡œ ë‹¤ì‹œ ëŒì•„ê°€ì„œ, Deployment íƒ­ì„ ëˆ„ë¥´ë©´, Deployment Statusë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë¡œê·¸ë¥¼ ì˜ ì½ì–´ë³´ë©´, ì–¸ì œ ì–´ë””ì„œ ì—ëŸ¬ê°€ ë‚¬ëŠ”ì§€ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆê³ , ëŒ€ëµì ì¸ Vercelì˜ ì‘ë™ ë°©ì‹ì— ëŒ€í•´ì„œ ì´í•´í•  ìˆ˜ ìˆë‹¤. install ìŠ¤í¬ë¦½íŠ¸, build ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ë¹Œë“œ ê²°ê³¼ë¥¼ ìì‹ ì˜ ì„œë²„ì— ë°°í¬í–ˆë‹¤ëŠ” ê²ƒì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

------

# ê³¼ì œ1. Vercelë¡œ í´ë¼ì´ì–¸íŠ¸ CI/CD êµ¬ì¶•í•˜ê¸°

ì´ë²ˆ ê³¼ì œì—ì„œëŠ” Next.js ê°œë°œì‚¬ë¡œ ìœ ëª…í•œ Vercelì˜ CI/CD ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ React SPA ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•´ë³¸ë‹¤.

- ìì‹ ì˜ ê¹ƒí—ˆë¸Œì— ë¦¬ì•¡íŠ¸ë¡œ ì œì‘í•œ ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ë ˆí¼ëŸ°ìŠ¤, í˜¹ì€ ìì‹ ì˜ ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ë°°í¬í•œë‹¤.
- ìµœì†Œí•œ í•˜ë‚˜ ì´ìƒì˜ í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê³ , í…ŒìŠ¤íŠ¸ê°€ í†µê³¼ë˜ì–´ì•¼ ë°°í¬ë˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

## ë¬¸ì œí•´ê²°ê³¼ì •

ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì„ ì´ìš©í•´ ì§€ì†ì ì¸ í†µí•©, ë°°í¬ë¥¼ í•´ë³´ê³ ì í–ˆë‹¤.
(ì†ŒìŠ¤ì½”ë“œëŠ” ìœ„ì—ì„œ ì‹¤ìŠµí•œ ì§€ì†ì ì¸ í†µí•© ë ˆí¬ì§€í† ë¦¬ ì½”ë“œë¥¼ í™œìš©í–ˆë‹¤.)

1. ì´ë¯¸ ì†ŒìŠ¤ì½”ë“œë¥¼ ë‚´ ì»´í“¨í„°ì— `git clone`í•œ ìƒíƒœì˜€ê³ , ì›ê²©ì €ì¥ì†Œ Remote ì„¤ì •ì„ í†µí•´ ë‚´ê°€ PR ë³´ë‚¼ ê³³ì„ ì¶”ê°€í–ˆë‹¤. PRìš© branchë¥¼ ìƒì„±í–ˆë‹¤.

```sh
# ê¸°ì¡´ ë‚˜ë§Œì˜ ì•„ê³ ë¼ ìŠ¤í…Œì´ì¸  ì„œë²„ ë ˆí¼ëŸ°ìŠ¤ í´ë¡ 
git clone git@github.com:codestates-seb/fe-sprint-my-agora-states-server-reference.git
# ë””ë ‰í„°ë¦¬ ì´ë™
cd fe-sprint-my-agora-states-server-reference
# ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì›ê²© ë¦¬í¬ì§€í† ë¦¬ë¡œ ë“±ë¡ / PR ë³´ë‚¼ ê³³ì„ ì¶”ê°€í•˜ëŠ” ì½”ë“œ
git remote add myRepo git@github.com:{ì—¬ëŸ¬ë¶„ì˜ ì•„ì´ë””}/{ìƒˆë¡œ ë§Œë“  ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„}.git
# ê¸°ì¡´ ë ˆí¼ëŸ°ìŠ¤ ì½”ë“œë¥¼ ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¡œ push
git push myRepo reference
# PRìš© branch ìƒì„±í•˜ê¸°
git checkout -b moon
```

1. ê¹ƒí—ˆë¸Œ ì•¡ì…˜ ê°œë…ì„ ì´í•´í•œ ë’¤, ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•´ ymlíŒŒì¼ì„ ìˆ˜ì •í–ˆë‹¤.

- `pull request` ì´ë²¤íŠ¸ ë°œìƒì‹œ `index.test.js` í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°, prì— ì½”ë©˜íŠ¸ê°€ ë‹¬ë¦¬ê³  ìë™ìœ¼ë¡œ `Closed`ë˜ë„ë¡ í–ˆë‹¤.
  ì¦‰, ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  prì„ ë‚ ë ¤ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.

```yaml
//pullRequest.yml
name: Bare Minimum Requirements

on: 
  pull_request:
      branches:
      - reference

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Bare Minimum Requirements
        uses: actions/setup-node@v1
        with:
          node-version: '16'
      - name: npm install
        run: npm install
      - name: run test code
        run: npm test
      - name: if fail
        uses: actions/github-script@0.2.0 
        with:
          github-token: ${{github.token}}  
          script: |                       
            const ref = "${{github.ref}}"
            const pull_number = Number(ref.split("/")[2])
            await github.pulls.createReview({
              ...context.repo,
              pull_number,
              body:"í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”ğŸ˜ ",
              event: "REQUEST_CHANGES"
            })
            await github.pulls.update({
              ...context.repo,
              pull_number,
              state: "closed"
            })
        if: failure()                 
```

1. `server` ë””ë ‰í† ë¦¬ì˜ `app.js`ì—ì„œ 1ë²ˆ í…ŒìŠ¤íŠ¸ ì •ë‹µì„ ì˜ë„ì ìœ¼ë¡œ ì˜¤ë‹µìœ¼ë¡œ ì‘ì„±í•œ ë’¤, PRìš© branchì— Pushí•˜ë©° `pull request`ë¥¼ ë³´ëƒˆë‹¤.

```sh
git add app.js
git commit -m "ìˆ˜ì •"
git push myRepo moon
```

1. ì˜ë„ì— ë§ê²Œ PRì´ closeë˜ëŠ”ì§€ í™•ì¸í–ˆë‹¤.
   ![img](https://velog.velcdn.com/images/mmmdo21/post/ba170b1b-0cd0-4506-a1ff-c3a0d90e05f7/image.png)

## ì°¸ê³ 

[ë¸Œëœì¹˜ ìƒì„± ë° í’€ë¦¬í€˜ìŠ¤íŠ¸ ë³´ë‚´ëŠ” ë²•](https://chanhuiseok.github.io/posts/git-3/)
[GitHub Actions ë¡œ í’€ë¦¬í€˜ìŠ¤íŠ¸ test ê²€ì¦í•˜ê¸°](https://velog.io/@adam2/GitHub-Actions-ë¡œ-í’€ë¦¬í€˜ìŠ¤íŠ¸-test-ê²€ì¦í•˜ê¸°)

------

# ê³¼ì œ2. ì„œë²„ ë°°í¬í•˜ê¸° (AWS)

![img](https://velog.velcdn.com/images/mmmdo21/post/bd7f3756-4dd4-4307-aef5-8cbcd6ae3227/image.png)[ê·¸ë¦¼] ì„œë²„ ë°°í¬ ìë™í™” íŒŒì´í”„ë¼ì¸

- AWS ê°œë°œì ë„êµ¬ ì„œë¹„ìŠ¤

  ë¥¼ ì´ìš©í•´ì„œ ë°°í¬ ìë™í™” íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•´ì•¼ í•œë‹¤.

  - **CodePipeline**ì„ ì´ìš©í•´ì„œ ê° ë‹¨ê³„ë¥¼ ì—°ê²°í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•œë‹¤.
  - **Source** ë‹¨ê³„ì—ì„œ ì†ŒìŠ¤ ì½”ë“œê°€ ì €ì¥ëœ GitHub ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì—°ê²°í•œë‹¤.
  - **Deploy** ë‹¨ê³„ì—ì„œ **CodeDeploy** ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ EC2 ì¸ìŠ¤í„´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•œë‹¤.

- ë‚˜ì¤‘ì— ë³€ê²½ ì‚¬í•­ì„ GitHub ë¦¬í¬ì§€í† ë¦¬ì— ë°˜ì˜í–ˆì„ ê²½ìš°, ë°°í¬ ê³¼ì •ì´ ìë™ìœ¼ë¡œ ì§„í–‰ë˜ì–´ì•¼ í•œë‹¤.

- ë°°í¬ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ìƒê¸¸ ê²½ìš°, **log íŒŒì¼**ì„ ì°¸ì¡°í•˜ì—¬ ë¬¸ì œì ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

## ìˆœì„œ

1. ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
2. ì¸ìŠ¤í„´ìŠ¤ì— ê°œë°œ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

```sh
// íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ê°€ ê´€ë¦¬í•˜ëŠ” íŒ¨í‚¤ì§€ì˜ ì •ë³´ë¥¼ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
sudo apt update
//nvm ì„¤ì¹˜
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash

export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm

// node.js ì„¤ì¹˜
nvm install node 
// npm ì„¤ì¹˜
sudo apt install npm
```

3.ì¸ìŠ¤í„´ìŠ¤ì— íƒœê·¸ ë° ì—­í•  ë¶€ì—¬

- íƒœê·¸ì¶”ê°€
- ìƒˆ IAM ì—­í•  ìƒì„±
  - AmazonS3FullAccess
  - AmazonSSMFullAccess
  - AWSCodeDeployRole
- ì‹ ë¢°ê´€ê³„ í¸ì§‘
  - Service ë¶€ë¶„ ì•„ë˜ì™€ ê°™ì´ í¸ì§‘
  - `["ec2.amazonaws.com", "codedeploy.ap-northeast-2.amazonaws.com"]`
- ë³´ì•ˆê·¸ë£¹ í™•ì¸
  - ì¸ë°”ìš´ë“œ ê·œì¹™ í¸ì§‘ - í¬íŠ¸ 80, 443(ìœ„ì¹˜ ë¬´ê´€)

4.EC2ë¥¼ í™œìš©í•œ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ì‹¤ìŠµ

- íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
  - ymlíŒŒì¼ì¶”ê°€, scriptsíŒŒì¼ ì¶”ê°€
  - ê²½ë¡œ ì•ë¶€ë¶„ `/home/ssm-user/`

```yaml
//appspec.yml
version: 0.0
os: linux
files:
  - source: /
# ì•„ë˜ destinationì€ ì—¬ëŸ¬ë¶„ì´ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ë¥¼ í´ë¡ í•œ ìœ„ì¹˜ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.
    destination: /home/ssm-user/fe-sprint-practice-deploy

hooks:
  ApplicationStop:
    - location: scripts/stop.sh
      runas: root
  AfterInstall:
    - location: scripts/initialize.sh
      runas: root
  ApplicationStart:
    - location: scripts/start.sh
      runas: root
//initialize.sh, start.sh, stop.sh
cd /home/ssm-user/fe-sprint-practice-deploy/server
```

- codeDeploy
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±, ë°°í¬ê·¸ë£¹ ìƒì„±
- codePipeline
  - íŒŒì´í”„ë¼ì¸ ìƒì„±, ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ ì—°ê²°

### ê²°ê³¼

![img](https://velog.velcdn.com/images/mmmdo21/post/56878420-7f69-46c2-b74f-c5b675a82b61/image.png)
![img](https://velog.velcdn.com/images/mmmdo21/post/23ea96e1-2cf5-4525-9d9e-72267437a237/image.png)

------

### +codeDeploy lifecyle

![img](https://velog.velcdn.com/images/mmmdo21/post/eff3fa4d-d46e-466c-a928-fdcff9fff6d5/image.png)