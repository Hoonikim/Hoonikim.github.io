---
title: "[OMT] ë¡œê·¸ì¸ Token ë³´ì•ˆ1 (AccessToken ì „ì—­ê´€ë¦¬)"
categories: ì„±ëŠ¥ê°œì„ 
tags: [ì„±ëŠ¥ê°œì„ , OMT]
toc: true
layout: archive
author_profile: true
types: posts
docs: OMT

---

###  2024.03.05(í™”)

<div  align="center">
  <img width="80%" src="https://github.com/Hoonikim/Hoonikim.github.io/assets/104547038/42b8a22b-1b1d-4282-b19c-e02453d974f8" alt="OMT">
</div>



ì„±ëŠ¥ê°œì„ ì„ ë§ˆì¹˜ê³  ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì„ ë¦¬íŒ©í† ë§í•˜ê¸° ì‹œì‘í–ˆë‹¤. 

í˜„ì¬ê¹Œì§€ ë‚˜ëŠ” accessTokenì„ LocalStorageì— ì €ì¥í•´ì™”ë‹¤. ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” refreshTokenì„ ë”°ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³  accessTokenì´ ë§Œë£Œë˜ë©´ ë¡œê·¸ì•„ì›ƒ ë˜ë„ë¡ ì§„í–‰í•´ì™”ë‹¤. 
ì´ ë°©ë²•ì€ ìœ ì €ë¡œ í•˜ì—¬ê¸ˆ ë¶ˆí¸í•¨ì„ ëŠë‚„ ìˆ˜ ìˆê³  ì—¬ëŸ¬ ê³µê²©ì— ìˆì–´ ì•ˆì „í•œ ë°©ë²•ì´ ì•„ë‹ˆê¸°ì— `ë°˜ë“œì‹œ ë¦¬íŒ©í† ë§ì„ ì§„í–‰í•´ì•¼ê² ë‹¤.`  ìƒê°í–ˆê³  ê·¸ê²Œ ì˜¤ëŠ˜ì´ë‹¤. 



### ğŸ§ ê³µê²©? ê³µê²©ì—” ë¬´ìŠ¨ ê³µê²©ì´ ìˆì„ê¹Œ 

ìš°ì„  ì´ëŸ° í† í°ì— ê´€ë ¨í•œ ê³µê²©ì€ CSRF, XSS ê³µê²© ë‘ê°€ì§€ê°€ ìˆë‹¤. 



> #### XSS ( Cross Site Scripting )
>
> ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ ì›¹í˜ì´ì§€ì— ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚½ì…



í•´ì»¤ëŠ” ì´ XSSê³µê²©ì„ ì„±ê³µí•œë‹¤ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê³  ì¿ í‚¤, ë¡œì»¬ìŠ¤í† ë¦¬ì§€, ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. 

ì´ ì¤‘ ì¿ í‚¤ëŠ” HttpOnly ì†ì„±ì„ ì¶”ê°€í•´ ì´ ê³µê²©ì„ ë°©ì–´í•  ìˆ˜ ìˆë‹¤. 



> #### CSRF ( Cross Site Request Forgery )
>
> ì‚¬ìš©ìê°€ ìì‹ ì˜ ì˜ì§€ì™€ëŠ” ë¬´ê´€í•˜ê²Œ ê³µê²©ìê°€ ì˜ë„í•œ í–‰ìœ„(ìˆ˜ì •, ì‚­ì œ, ë“±ë¡ ë“±)ë¥¼ íŠ¹ì • ì›¹ì‚¬ì´íŠ¸ì— ìš”ì²­í•˜ê²Œ í•˜ëŠ” ê³µê²©
>
> ì‚¬ìš©ìë¥¼ í•´ì»¤ê°€ ë§Œë“  ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ê²Œ í•˜ê±°ë‚˜, íŠ¹ì • ë§í¬ë¥¼ í´ë¦­í•˜ë„ë¡ ìœ ë„í•˜ì—¬ Cross Site ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³µê²© ê¸°ë²•.



ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ê¸° ë•Œë¬¸ì— ì¿ í‚¤ëŠ” í•¨ê»˜ ì „ë‹¬ë  ìˆ˜ë°–ì— ì—†ê³ ì„œë²„ ì…ì¥ì—ì„œëŠ” ì´ê²Œ ì‚¬ìš©ìê°€ ë³´ë‚¸ ìš”ì²­ì¸ì§€, í•´ì»¤ê°€ ë³´ë‚¸ ìš”ì²­ì¸ì§€ ì•Œ ê¸¸ì´ ì—†ë‹¤.

ì´ë¥¼ ë§‰ê¸° ìœ„í•´ ì¿ í‚¤ì— Same Site ì†ì„±ì„ í™œìš©í•˜ë©´ ëœë‹¤. 

### ì •ë‹µ?

`AccessToken = ë©”ëª¨ë¦¬ì— ì €ì¥`

`refreshToken = ë³´ì•ˆì´ ì ìš©ëœ ì¿ í‚¤ì— ì €ì¥`



### ğŸª Cookie ë³´ì•ˆ 

ì¿ í‚¤ì˜ ë³´ì•ˆì€ í¬ê²Œ 3ê°€ì§€ê°€ ìˆë‹¤. 

> #### Http Only
>
> Cookieë¥¼ HTTP í†µì‹ ì—ì„œë§Œ ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡í•˜ëŠ” ì˜µì…˜.
>
>  ì„¤ì •ì„ í•˜ì§€ ì•Šì„ ê²½ìš° XSS ê³µê²©ì„ í†µí•´ ì¿ í‚¤ì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. Cookieì— Refresh Tokenì„ ì €ì¥í•œë‹¤ë©´ **í•„ìˆ˜**.

-----------

> #### Secure
>
> Secure ì„¤ì •ì´ í™œì„±í™”ë˜ë©´ HTTPS ë¥¼ í†µí•´ì„œë§Œ Cookieê°€ ë°œê¸‰.

----------

> #### SameSite
>
> **Strict**
> Cross Siteì—ì„œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì¿ í‚¤ë¥¼ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤.
>
> **Lax** [ í˜„ì¬ í¬ë¡¬ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ ]
> Cross Siteì—ì„œ ìš”ì²­ì„ ë³´ë‚´ë©´, íŠ¹ì •í•œ ì¡°ê±´ì´ ë§Œì¡±í•  ë•Œë§Œ ì¿ í‚¤ë¥¼ ì „ë‹¬.
> íŠ¹ì •í•œ ì¡°ê±´ì´ë€ HTMLì˜ ìµœìƒë‹¨ì—ì„œ í˜ì´ì§€ ì´ë™ì´ ì¼ì–´ë‚˜ëŠ” ê²½ìš°ë¥¼ ì˜ë¯¸. `<a>` íƒœê·¸ë‚˜ `location.href` ì†ì„±ì„ ì‚¬ìš©í•˜ëŠ” ìƒí™©ì´ ìˆë‹¤.
>
> **None**
> Cross Siteì—ì„œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì¿ í‚¤ë¥¼ ì „ë‹¬.



ì¿ í‚¤ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ì´ê³³ì—ì„œ .... ê±°ì˜ 3ì¼ì„ ì‚½ì§ˆí–ˆë‹¤.. 



### ì ê·¸ëŸ¼ ì´ì œ AccessTokenì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•´ì„œ ê´€ë¦¬í•´ë³´ì 

ë‚˜ëŠ” Next.js 13ë²„ì „ì„ ì‚¬ìš©í•´ ê°œë°œì„ ì§„í–‰í–ˆê³  ì „ì—­ë³€ìˆ˜ ê´€ë¦¬ëŠ” useContextë¥¼ ì‚¬ìš©í–ˆë‹¤. 

#### 1. AuthContext.tsx ì‘ì„± 

```tsx 
...

export const AuthProvider: React.FC<{ children: ReactNode }> = ({
  children
}) => {
  const [accessToken, setAccessToken] = useState<string | null>(null);

  return (
    <AuthContext.Provider value={{ accessToken, setAccessToken }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuthëŠ” ë°˜ë“œì‹œ AuthProviderì™€ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
  }
  return context;
};
```



#### 2. layout.tsxì— AuthProvider ì ìš©

```tsx
import { AuthProvider } from '@/components/AuthContext';

...

 <body className={inter.className}>
          <AuthProvider>{children}</AuthProvider>
        </body>
```



#### 3. ë¡œê·¸ì¸ ì½”ë“œ ìˆ˜ì • 

ê¸°ì¡´ ì½”ë“œê°€ accessTokenì„ localStorageì— ì €ì¥í•˜ëŠ” ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì£¼ì–´ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê²Œ í–ˆë‹¤. 

```tsx
import { useAuth } from '@/components/AuthContext';
...

const { setAccessToken } = useAuth();
const accessToken: string | null = urlSearchParams.get('token');
...

    useEffect(() => {
      const fetchData = async () => {
        try {
          if (accessToken) {
            setAccessToken(accessToken);
            const res = await axios.get(`${OAuthURL}/api/v1/users`, {
              headers: {
                Authorization: `Bearer ${accessToken}`
              }
            });

            const UserInfo = res.data.body.response;
            localStorage.setItem('UserInfo', JSON.stringify(UserInfo));
            // ë‹¤ë¥¸ ì •ë³´ë„ í•„ìš”í•˜ë©´ Contextì— ì €ì¥ ê°€ëŠ¥
            router.push('/home');
          }
        } catch (error) {
          console.error('Axios Error:', error);
        }
      };

      fetchData();
    }, [accessToken]);
  }
  
  ...
  
```

ì´ íŒŒíŠ¸ì—ì„œ ì¤‘ìš”í•˜ì§€ ì•Šì€ ë‚´ìš©ë“¤ì€ ìƒëµí–ˆë‹¤. 

ìœ ì € ì •ë³´ëŠ” ì´ë¦„, ì‚¬ì§„ ì •ë„ë¿ì´ë¼ localStorageì— ì €ì¥í•˜ëŠ” ê²ƒì„ ìˆ˜ì •í•˜ì§€ ì•Šì•˜ë‹¤. 


ì´í›„ ìš”ì²­ í—¤ë”ì— accessTokenì´ í•„ìš”í•  ê²½ìš° 

`const { AccessToken } = useAuth();` ì„ í™œìš©í•´ì„œ ìš”ì²­ì„ ì§„í–‰í–ˆë‹¤. 



ì´ì œ accessTokenì€ ë©”ëª¨ë¦¬ì— ì €ì¥í–ˆìœ¼ë‹ˆ cookieì— refreshTokenì´ ì˜ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ê°±ì‹ ì„ ì‹œë„í•´ë³´ì 
