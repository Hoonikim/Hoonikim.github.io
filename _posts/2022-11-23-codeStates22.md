---
layout: single
title: "[Node Js] -fs ëª¨ë“ˆ ê³¼ì œ"
categories: JavaScript
tags: [ JS, CodeStates]
toc: true

---

### 2022.11.23

### ğŸ’¡  ì˜¤ëŠ˜ì˜ JavaScript ê³µë¶€ 

#### â–¶ï¸ -fs ëª¨ë“ˆ ê°œìš” 

ë¸Œë¼ìš°ì € í™˜ê²½ê³¼ëŠ” ë‹¤ë¥´ê²Œ Node.js í™˜ê²½ì€ ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì§ì ‘ ì‹¤í–‰ë˜ë¯€ë¡œ, íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì €ì¥í•˜ëŠ” ë“±ì˜ ì•¡ì…˜ì´ ê°€ëŠ¥í•˜ë‹¤. File System module ì‚¬ìš©ë²•ì„ ì˜ ìµíŒë‹¤ë©´ 'íŒŒì¼ì—´ê¸°', 'íŒŒì¼ ì €ì¥í•˜ê¸°'ë“±ì„ ì§ì ‘ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. 

##### ğŸ“ŒcallBack.js

```js
const fs = require('fs')	// fs ëª¨ë“ˆì„ ì‚¬ìš©í•˜ê² ë‹¤. 

const getDataFromFile = function (filePath, callback) {
  // TODO: fs.readFileì„ ì´ìš©í•´ ì‘ì„±í•©ë‹ˆë‹¤
  // fs ëª¨ë“ˆì„ ì´ìš©í•´ì„œ filePathë¼ëŠ” íŒŒì¼ì„ ì½ì„ ê²ƒì´ê³  'utf8ë¡œ ì¸ì½”ë”©', íŒŒì¼ì„ ì½ì€ í›„ í˜¸ì¶œí•˜ëŠ” ì½œë°±í•¨ìˆ˜
  fs.readFile(filePath,'utf8',function(err,data){   
    if(err){ //ë§Œì•½ íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìœ¼ë©´ 
      callback(err, null); // errë¥¼ ì¶œë ¥í•˜ê³  dataëŠ” null
    }else{  // ê·¸ê²Œ ì•„ë‹ˆë¼ë©´ 
      callback(null,data) // errëŠ” ì—†ê³  dataë¥¼ ì¶œë ¥í•´ë¼ 
    }
  })
};

getDataFromFile('README.md', (err, data) => console.log(data));

module.exports = {
  getDataFromFile
};
```



##### ğŸ“Œ promiseConstructor.js

```js
const fs = require("fs");

const getDataFromFilePromise = filePath => {
  // return new Promise()
  // TODO: Promise ë° fs.readFileì„ ì´ìš©í•´ ì‘ì„±í•©ë‹ˆë‹¤.
  // ! callbackëŒ€ì‹  Promiseì˜ resolve, reject í•¨ìˆ˜ë¥¼ ì´ìš©í•´ë¼
  return new Promise(function(resolve,reject){
    fs.readFile(filePath,'utf8',function(err,data){
      if(err){
        reject(err)
      }else{
        resolve(data)
      }
    })
  })
};
```

* callback ëŒ€ì‹  Promise í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë¼ê³  í–ˆìœ¼ë‹ˆê¹Œ new Promiseë¥¼ í˜¸ì¶œí•´ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë™ê¸°í™” ì‹œí‚¨ë‹¤. 
* ê·¸ ë‹¤ìŒì€ ìœ„ì˜ callback.jsì˜ ì˜ì‚¬ì½”ë“œì™€ ê°™ìŒ 

##### ğŸ“Œ basicChaining.js

* fs ëª¨ë“ˆì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. 
* getDataFromFilePromiseë¥¼ ì´ìš©í•´, 'files/user1.json' íŒŒì¼ê³¼ 'files/user2.json' íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê³ ,  ë‘ íŒŒì¼ì„ í•©ì³ì„œ ìµœì¢…ì ìœ¼ë¡œ ë‘ ê°ì²´ê°€ ë‹´ê¸´ ë°°ì—´ì„ ë§Œë“œëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
* íŒŒì¼ ê²½ë¡œë¥¼ ì°¾ì„ ë•Œ, user1Path ë° user2Pathë¥¼ ì´ìš©í•˜ì„¸ìš”.
* íŒŒì¼ ì½ê¸°ì˜ ê²°ê³¼ê°€ ë¬¸ìì—´ì´ë¯€ë¡œ, JSON.parse ë¥¼ ì‚¬ìš©í•´ì•¼ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
const { get } = require('http');
const path = require('path');
const { getDataFromFilePromise } = require('./02_promiseConstructor');

const user1Path = path.join(__dirname, 'files/user1.json');
const user2Path = path.join(__dirname, 'files/user2.json');

// HINT: getDataFromFilePromise(user1Path) ë° getDataFromFilePromise(user2Path)ë¥¼ ì´ìš©í•´ ì‘ì„±í•©ë‹ˆë‹¤
const readAllUsersChaining = () => {
  // TODO: ì—¬ëŸ¬ê°œì˜ Promiseë¥¼ thenìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤
  return getDataFromFilePromise(user1Path)         // ! user1Path íŒŒì¼ ë°›ì•„ì˜¤ê¸°
  .then((user1Value) => JSON.parse(user1Value))    // ! íŒŒì¼ ì½ê¸°ì˜ ê²°ê³¼ê°€ ë¬¸ìì—´ì´ë¯€ë¡œ, JSON.parse ë¥¼ ì‚¬ìš©
  .then(user1 => {  // ! íŒŒì‹±ëœ ìë£Œë¥¼ user1ì— í• ë‹¹ 
    return getDataFromFilePromise(user2Path)  // ! ê·¸ ë’¤ user2Path íŒŒì¼ ë°›ì•„ì˜¤ê¸°
    .then((user2Value) => JSON.parse(user2Value)) // ! íŒŒì‹±í•´ì£¼ê³ 
    .then(user2 => { 
      return [user1, user2]  // ! ë‘ ê°ì²´ê°€ ë‹´ê¸´ ë°°ì—´ì„ ë§Œë“¤ê¸°
    })
  })
}
```

 

##### ğŸ“Œ promiseAll.js

* ìœ„ì˜ readAllUsersChainingê³¼ ì •í™•íˆ ê°™ì€ ê²°ê³¼ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤. 
* Promise.allì„ ë°˜ë“œì‹œ ì‚¬ìš©í•´ì„œ í’€ì–´ì•¼ í•©ë‹ˆë‹¤. 

```js
// Promise.all ì€ ì²˜ìŒë´ì„œ ì°¾ì•„ë³´ì•˜ë‹¤. 
// MDN Promise.all ì‚¬ìš©ë²•
const promise1 = Promise.resolve(3);
const promise2 = 42;
const promise3 = new Promise((resolve, reject) => {
  setTimeout(resolve, 100, 'foo');
});

Promise.all([promise1, promise2, promise3]).then((values) => {
  console.log(values);
});
// expected output: Array [3, 42, "foo"]
```

```js
const path = require('path');
const { getDataFromFilePromise } = require('./02_promiseConstructor');

const user1Path = path.join(__dirname, 'files/user1.json');
const user2Path = path.join(__dirname, 'files/user2.json');

const readAllUsers = () => {
  // TODO: Promise.allì„ ì´ìš©í•´ ì‘ì„±í•©ë‹ˆë‹¤
  const user1 = getDataFromFilePromise(user1Path); // user1ì— user1Path íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì„œ í• ë‹¹
  const user2 = getDataFromFilePromise(user2Path); // user2ì— user2Path íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ì„œ í• ë‹¹ 
  return Promise.all([user1,user2]).then((value) => {
    return value.map((el) => JSON.parse(el)) // ! ë‘ ë°ì´í„°ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ê³  
    // 1ëŒ€1 ë°ì´í„° map í™œìš©í•´ì„œ íŒŒì‹± 
  })
}
```



##### ğŸ“Œ asyncAwait.js

```js
// ìœ„ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë¦¬í„´ 
const path = require('path');
const { getDataFromFilePromise } = require('./02_promiseConstructor');

const user1Path = path.join(__dirname, 'files/user1.json');
const user2Path = path.join(__dirname, 'files/user2.json');

const readAllUsersAsyncAwait = async() => {    // ! await ì“¸ê±°ë¼ async í˜¸ì¶œ?
  // TODO: async/await í‚¤ì›Œë“œë¥¼ ì´ìš©í•´ ì‘ì„±í•©ë‹ˆë‹¤
  const user1 = await getDataFromFilePromise(user1Path); // ! user1path ë°›ì•„ì˜¤ê³ 
  const user2 = await getDataFromFilePromise(user2Path); // ! user2path ë°›ì•„ì˜¤ê³ 
  return [JSON.parse(user1),JSON.parse(user2)] // ! readAllUsersì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
}                                              // ! JSON.parseì¨ì„œ ê°™ì€ ë°°ì—´ë¡œ ë¬¶ì–´ì£¼ë€ ì–˜ê¸°
```



ì´ë²ˆ ê³¼ì œëŠ” ì˜ì‚¬ì½”ë“œë¥¼ ë§ì´ ì ì–´ì„œ ì´í•´ë¥¼ ë„ì™”ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ëŠ” ìˆ˜ê³ ë¥¼ ëœì–´ ì‹œê°„ì„ ë§ì´ ë‹¨ì¶•í•  ìˆ˜ ìˆì—ˆë‹¤. 